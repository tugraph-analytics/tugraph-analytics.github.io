---
layout: post
read_time: true
show_date: true
show_author: true
title: "å›¾åŠ é€Ÿæ•°æ®æ¹–åˆ†æ-TuGraphå’ŒHudié›†æˆ"
date: 2023-07-12
tags: [Hudi, å›¾è®¡ç®—, æ•°æ®æ¹–, GeaFlow, å¼€æº, github]
category: news
author: TuGraph
description: "æœ¬æ–‡ä¸»è¦åˆ†æäº†è¡¨æ¨¡å‹çš„ç°çŠ¶å’Œé—®é¢˜ï¼Œç„¶åä»‹ç»äº†å›¾æ¨¡å‹åœ¨å¤„ç†å…³ç³»è¿ç®—ä¸Šçš„ä¼˜åŠ¿ï¼Œæ¥ç€ä»‹ç»äº†å›¾è®¡ç®—å¼•æ“GeaFlowå’Œæ•°æ®æ¹–æ ¼å¼hudiçš„æ•´åˆï¼Œåˆ©ç”¨å›¾è®¡ç®—å¼•æ“åŠ é€Ÿæ•°æ®æ¹–ä¸Šçš„å…³ç³»è¿ç®—."
---
## è¡¨æ¨¡å‹ç°çŠ¶ä¸é—®é¢˜
å…³ç³»æ¨¡å‹è‡ª1970å¹´ç”±åŸƒå¾·åŠ Â·ç§‘å¾·æå‡ºæ¥ä»¥åè¢«å¹¿æ³›åº”ç”¨äºæ•°æ®åº“å’Œæ•°ä»“ç­‰æ•°æ®å¤„ç†ç³»ç»Ÿçš„æ•°æ®å»ºæ¨¡ã€‚å…³ç³»æ¨¡å‹ä»¥è¡¨ä½œä¸ºåŸºæœ¬çš„æ•°æ®ç»“æ„æ¥å®šä¹‰æ•°æ®æ¨¡å‹ï¼Œè¡¨ä¸ºäºŒç»´æ•°æ®ç»“æ„ï¼Œæœ¬èº«ç¼ºä¹å…³ç³»çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå…³ç³»çš„è¿ç®—é€šè¿‡Joinå…³è”è¿ç®—æ¥å¤„ç†ã€‚è¡¨æ¨¡å‹ç®€å•ä¸”æ˜“äºç†è§£ï¼Œåœ¨å…³ç³»æ¨¡å‹ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚
éšç€äº’è”ç½‘ä¿¡æ¯æŠ€æœ¯çš„å‘å±•ï¼Œå¤„ç†çš„æ•°æ®è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œå¤§æ•°æ®ç³»ç»Ÿåº”è¿è€Œç”Ÿã€‚è¡¨æ¨¡å‹ä½œä¸ºé‡è¦çš„æ•°æ®æ¨¡å‹ä¾ç„¶è¢«Spark/Hive/Flinkç­‰ä¸»æµå¤§æ•°æ®å¼•æ“æ‰€é‡‡ç”¨ï¼Œè¡¨æ¨¡å‹ä¹‹ä¸Šçš„SQLæŸ¥è¯¢è¯­è¨€ä¹Ÿè¢«å¹¿æ³›ä½¿ç”¨åœ¨å¤§æ•°æ®åˆ†æå¤„ç†ä¸­ã€‚ç„¶è€Œéšç€åº”ç”¨åœºæ™¯çš„ä¸°å¯Œå’Œå¤„ç†æ•°æ®è§„æ¨¡çš„å˜å¤§ï¼Œè¡¨æ¨¡å‹çš„é—®é¢˜ä¹Ÿè¶Šæ¥è¶Šå¤šçš„æš´éœ²å‡ºæ¥ã€‚

- é¦–å…ˆï¼Œå…³ç³»è¿ç®—æˆæœ¬é«˜

è¡¨æ¨¡å‹æœ¬èº«ç¼ºä¹å…³ç³»æè¿°èƒ½åŠ›ï¼Œåªèƒ½é€šè¿‡Joinè¿ç®—æ¥å®Œæˆå…³ç³»çš„è®¡ç®—ã€‚æ— è®ºåœ¨æ‰¹å¤„ç†ç³»ç»Ÿé‡Œé¢è¿˜æ˜¯æµè®¡ç®—ç³»ç»Ÿä¸­ï¼ŒJoinéƒ½æ˜¯éå¸¸é‡çš„æ“ä½œï¼Œéœ€è¦å¤§é‡çš„æ•°æ®shuffleå’Œè®¡ç®—å¼€é”€ï¼Œåœ¨æµè®¡ç®—ç³»ç»Ÿä¸­ï¼Œè¿˜éœ€è¦å­˜æ”¾å·¦å³ä¸¤å¼ æµè¡¨çš„å†å²çŠ¶æ€ï¼Œå­˜å‚¨æ¶ˆè€—æé«˜ã€‚

- å…¶æ¬¡ï¼Œæ•°æ®å†—ä½™æ—¶æ•ˆæ€§ä½

æ•°ä»“åˆ†æçš„åœºæ™¯ä¸ºäº†æé«˜æ•°æ®æŸ¥è¯¢æ€§èƒ½ï¼Œå¾€å¾€å°†å¤šå¼ è¡¨æå‰ç‰©åŒ–æˆä¸€å¼ å¤§å®½è¡¨ã€‚å¤§å®½è¡¨è™½ç„¶å¯ä»¥åŠ é€ŸæŸ¥è¯¢æ€§èƒ½ï¼Œç„¶è€Œå…¶æ•°æ®è†¨èƒ€å’Œå†—ä½™éå¸¸ä¸¥é‡ã€‚éœ€è¦å°†å¤šå¼ è¡¨Joinæˆä¸€å¼ è¡¨ï¼Œè¡¨ä¸è¡¨ä¹‹é—´ä¸€å¯¹å¤šçš„å…³è”å…³ç³»å¯¼è‡´ä¸€å¼ è¡¨çš„æ•°æ®é€šè¿‡å…³è”ä¼šæ”¾å¤§å¤šä»½ï¼Œé€ æˆæ•°æ®é‡æŒ‡æ•°çº§è†¨èƒ€å’Œå†—ä½™ã€‚è€Œä¸”å®½è¡¨ä¸€æ—¦ç”Ÿæˆï¼Œå¦‚éœ€æ·»åŠ æ–°çš„è¡¨è¿›æ¥ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆæ–°å®½è¡¨ï¼Œè®¡ç®—å¼€é”€å¤§ï¼Œä¸çµæ´»ã€‚å¦å¤–ï¼ŒåŸºäºJoinæ–¹å¼æˆæœ¬é«˜ï¼ŒåŸºäºå®½è¡¨æ–¹å¼å¾ˆéš¾å®ç°æ•°ä»“å®æ—¶åŒ–ã€‚

- æœ€åï¼Œæ— æ³•æ”¯æŒå¤æ‚å…³ç³»æŸ¥è¯¢

åŸºäºSQL joinæ–¹å¼å¾ˆéš¾æè¿°å¤æ‚å…³ç³»æŸ¥è¯¢ï¼Œæ¯”å¦‚æŸ¥è¯¢ä¸€ä¸ªäºº4åº¦ä»¥å†…æ‰€æœ‰å¥½å‹æˆ–è€…æŸ¥è¯¢æœ€çŸ­è·¯å¾„ç­‰ã€‚è¿™äº›å¤æ‚å…³è”å…³ç³»é€šè¿‡SQLè¡¨çš„joinæ–¹å¼å¾ˆéš¾æè¿°ã€‚
## å›¾æ¨¡å‹è§£å†³æ–¹æ¡ˆ
### å›¾æ˜¯å…³ç³»çš„å¤©ç„¶æè¿°
å›¾æ˜¯å¯¹å…³ç³»çš„ä¸€ç§å¤©ç„¶æè¿°ï¼Œå›¾æ¨¡å‹æ˜¯ä¸€ç§ä»¥ç‚¹å’Œè¾¹ä½œä¸ºåŸºæœ¬å•å…ƒå®šä¹‰çš„æ•°æ®æ¨¡å‹å¤©ç„¶å¯ä»¥æè¿°å…³è”å…³ç³»ã€‚åœ¨å›¾æ¨¡å‹é‡Œé¢ä»¥ç‚¹ä»£è¡¨å®ä½“ï¼Œä»¥è¾¹ä»£è¡¨å…³ç³»ã€‚æ¯”å¦‚åœ¨äººé™…å…³ç³»å›¾é‡Œé¢ï¼Œæ¯ä¸€ä¸ªäººå¯ä»¥ç”¨ä¸€ä¸ªç‚¹æ¥è¡¨ç¤ºï¼Œäººå’Œäººä¹‹é—´çš„å…³ç³»é€šè¿‡è¾¹æ¥è¡¨ç¤ºï¼Œäººä¸äººä¹‹é—´å¯ä»¥å­˜åœ¨å„ç§å„æ ·çš„å¤æ‚å…³ç³»ï¼Œè¿™äº›å…³ç³»éƒ½å¯ä»¥é€šè¿‡ä¸åŒçš„è¾¹æ¥è¡¨ç¤ºã€‚æ‰€ä»¥å›¾æ¨¡å‹é‡Œé¢å¤©ç„¶å°±åŒ…å«å…³ç³»ï¼Œæ˜¯å¯¹å…³ç³»æœ€è‡ªç„¶çš„è¡¨è¾¾ã€‚

![image](../../../../assets/images/posts/20230712/g1.png)

### å›¾æ˜¯å…³ç³»çš„ç‰©åŒ–
å›¾æ¨¡å‹ä¸­æœ¬èº«åŒ…å«ç‚¹è¾¹å…³ç³»çš„å®šä¹‰ï¼Œåœ¨æ•°æ®å­˜å‚¨å±‚é¢ä¼šæŒ‰ç…§ç‚¹è¾¹å…³ç³»å­˜æ”¾æ•°æ®ï¼Œç‚¹å’Œå…¶é‚»è¾¹ä¼šå­˜å‚¨åœ¨ä¸€èµ·ã€‚æ‰€ä»¥å›¾å­˜å‚¨å±‚é¢å¯¹å…³ç³»åšäº†ç‰©åŒ–ï¼Œç›¸æ¯”ä¸è¡¨çš„Joinæ–¹å¼ï¼Œå¯ä»¥è·å–æ›´å¥½çš„å…³è”è®¡ç®—æ€§èƒ½ã€‚ç›¸æ¯”å®½è¡¨çš„å…³ç³»ç‰©åŒ–æ–¹å¼ï¼Œç”±äºå›¾ç»“æ„æœ¬èº«çš„ç‚¹è¾¹èšåˆæ€§ï¼Œä¸ä¼šå‡ºç°å®½è¡¨å±•å¼€å¯¼è‡´çš„æ•°æ®è†¨èƒ€ï¼Œå…¶å­˜å‚¨ç©ºé—´ä¼šæ›´å°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![image](../../../../assets/images/posts/20230712/g2.png)

### å›¾åŠ é€Ÿæ•°æ®æŸ¥è¯¢
åˆ©ç”¨å›¾çš„å…³ç³»ç‰©åŒ–çš„èƒ½åŠ›ï¼Œå¯ä»¥åŠ é€Ÿå…³ç³»è¿ç®—çš„æŸ¥è¯¢ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š
å­¦ç”Ÿã€è¯¾ç¨‹å’Œæ•™å¸ˆä¸‰ä¸ªå®ä½“è¡¨ï¼Œå®ä½“ä¹‹é—´å­˜åœ¨é€‰è¯¾(selectCourse)ã€è€ƒè¯•(examination)å’Œæ•™å­¦(teach)ä¸‰ç§å…³ç³».è¿™äº›å®ä½“ä¹‹é—´çš„å…³ç³»æŸ¥è¯¢å¯ä»¥é€šè¿‡å›¾æŸ¥è¯¢æ¥è¡¨ç¤ºã€‚

![image](../../../../assets/images/posts/20230712/g3.png)

- æŸ¥è¯¢æ•°å­¦è€ƒè¯•æˆç»©å‰åçš„å­¦ç”ŸåŠå…¶åˆ†æ•°
```sql
select s.id, s.name, e.score 
from student s join examination e join c course
on s.id = s.student_id and e.course_id = c.id
where c.name = 'math'
order by e.score desc limit 10
```
å¯¹åº”å›¾æŸ¥è¯¢ï¼š
```sql
Match(s:student) - [e:examination]->(c:course where c.name = 'math')
Return s.id, s.name, e.score order by e.score desc limit 10
```

- æŸ¥è¯¢é€‰è¯¾äººæ•°æœ€å¤šçš„è€å¸ˆTop 3
```sql
select tr.id, count(s.id) 
from student s join selectCourse sc join course c 
join teach th join teacher tr
on s.id = sc.student_id and sc.course_id = c.id and c.id = th.course_id
and th.teacher_id = tr.id
order by count(s.id) desc
limit 3
```
å¯¹åº”å›¾æŸ¥è¯¢ï¼š
```sql
Match(s:student)-[sc:selectCourse]->(c:course)<-[th:teach]-(tr:teacher)
Return tr.id, count(s.id) as cnt order by cnt desc limit 3
```

### å›¾æ¨¡å‹å’Œè¡¨æ¨¡å‹å…³ç³»
å›¾æ¨¡å‹æœ¬èº«åŒ…å«ç‚¹æ•°æ®é›†å’Œè¾¹æ•°æ®é›†ï¼Œç‚¹è¾¹æ•°æ®é›†æ¥æºäºè¡¨æ•°æ®ï¼Œæ¯”å¦‚Hiveè¡¨ã€Hudiè¡¨ç­‰ã€‚æ‰€ä»¥ï¼Œå›¾æ¨¡å‹æ˜¯è¡¨æ¨¡å‹çš„è¶…é›†ï¼Œæ˜¯å¯¹è¡¨æ¨¡å‹çš„è¡¥å……å’Œå®Œå–„ã€‚å›¾æ¨¡å‹å¯ä»¥èµ·åˆ°ç±»ä¼¼å®½è¡¨çš„ä½œç”¨ï¼Œç‰©åŒ–è¡¨çš„å…³ç³»ï¼ŒåŒæ—¶èƒ½æ›´çµæ´»çš„å®šä¹‰å…³ç³»ï¼Œæ¶ˆè€—æ›´å°çš„å­˜å‚¨å¼€é”€.

## GeaFlowå’ŒHudié›†æˆ
GeaFlow(å“ç‰ŒåTuGraph-Analytics)æ˜¯èš‚èšè‡ªç ”çš„åˆ†å¸ƒå¼å®æ—¶å›¾è®¡ç®—å¼•æ“ï¼Œå…¼é¡¾ç¦»çº¿å›¾è®¡ç®—èƒ½åŠ›ã€‚GeaFlowä»¥å›¾æ¨¡å‹ä½œä¸ºåŸºæœ¬çš„æ•°æ®æ¨¡å‹ï¼Œåœ¨å›¾æ¨¡å‹åŸºç¡€ä¹‹ä¸Šå®šä¹‰äº†ä¸€å¥—å›¾è®¡ç®—çš„ç¼–ç¨‹æ¥å£ï¼ŒåŒæ—¶å’Œæµå¼å¤„ç†èƒ½åŠ›ç›¸ç»“åˆï¼Œå®ç°äº†æµå¼å›¾è®¡ç®—çš„èƒ½åŠ›ã€‚åœ¨DSLè¯­è¨€å±‚é¢ï¼ŒGeaFlowå°†è¡¨å¤„ç†è¯­è¨€SQLå’Œå›¾æŸ¥è¯¢è¯­è¨€ISO/GQLç›¸ç»“åˆï¼Œå®ç°äº†å›¾è¡¨ä¸€ä½“çš„æ•°æ®åˆ†æèƒ½åŠ›ã€‚é€šè¿‡GeaFlowå›¾è®¡ç®—çš„èƒ½åŠ›ï¼Œå¾ˆå¥½çš„è§£å†³äº†å¤§è§„æ¨¡æ•°æ®å…³è”å…³ç³»è®¡ç®—çš„é—®é¢˜ã€‚

Hudiæ˜¯ä¸šç•Œçƒ­é—¨çš„æ•°æ®æ¹–æ ¼å¼ï¼Œæ—¨åœ¨è§£å†³æ•°æ®æ¹–ä¸­æ•°æ®çš„å˜æ›´ç®¡ç†é—®é¢˜ã€‚Hudiä½¿ç”¨äº†ä¸€ç§åŸºäºæ—¥å¿—çš„å­˜å‚¨æ–¹å¼ï¼Œå¯ä»¥æ”¯æŒæ•°æ®çš„å®æ—¶å¢é‡ã€åˆ é™¤å’Œæ›´æ–°ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚Hudiçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ•°æ®åˆ’åˆ†æˆå°çš„æ•°æ®å—ï¼Œæ¯ä¸ªæ•°æ®å—éƒ½åŒ…å«äº†æ•°æ®çš„å˜æ›´å†å²ï¼Œå¯ä»¥é€šè¿‡å¢é‡æ–¹å¼å’Œå…¨é‡æ–¹å¼è¯»å–å’Œå†™å…¥æ•°æ®ã€‚Hudiæ”¯æŒå¤šç§æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬Parquetã€ORCã€CSVç­‰ï¼Œå¹¶ä¸”å¯ä»¥ä¸Hadoopã€Sparkã€Flinkç­‰å¤§æ•°æ®å¤„ç†æ¡†æ¶æ— ç¼é›†æˆï¼Œå¯ç”¨äºæ•°æ®æ¹–çš„å»ºè®¾å’Œæ•°æ®ç®¡ç†ã€‚Hudiçš„å‡ºç°å¤§å¤§ç®€åŒ–äº†æ•°æ®æ¹–çš„æ•°æ®å˜æ›´ç®¡ç†å’Œæ•°æ®å¤„ç†æµç¨‹ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„æ•°æ®ç®¡ç†æ¡†æ¶ã€‚

GeaFlowæ”¯æŒå’Œå¤šç§æ•°æ®æºé›†æˆï¼ŒåŒ…æ‹¬Hudiã€‚åˆ©ç”¨GeaFlowå›¾è®¡ç®—çš„èƒ½åŠ›ï¼Œå¯ä»¥å¯¹Hudiæ•°æ®æ¹–æ•°æ®åšå…³ç³»ç‰©åŒ–ï¼ŒåŠ é€ŸDWDå±‚çš„æŸ¥è¯¢æ€§èƒ½å’Œæ—¶æ•ˆæ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŸºäºå›¾æ•°æ®åšæ›´å¤šå¤æ‚çš„å›¾ç®—æ³•åˆ†æã€‚

![image](../../../../assets/images/posts/20230712/g4.png)

ä»¥ä¸‹ä¸ºGeaFlowä½¿ç”¨Hudiæ„å›¾ï¼Œç„¶åè¿›è¡Œ4åº¦ç¯è·¯æŸ¥æ‰¾å’ŒSSSPç®—æ³•è®¡ç®—çš„ä¾‹å­ï¼š
### å›¾å®šä¹‰
æˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰å¼ å›¾ï¼Œä½¿ç”¨Create Graphè¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š
```sql
CREATE GRAPH IF NOT EXISTS friend (
  Vertex person (
    id bigint ID,
    name varchar
  ),
  Edge knows (
    srcId bigint SOURCE ID,
    targetId bigint DESTINATION ID,
    weight double
  )
) WITH (
  storeType='rocksdb',
  shardCount = 4
);
```
è¿™å¼ å›¾å®šä¹‰åŒ…å«ç‚¹è¡¨personå’Œè¾¹è¡¨knows. ç‚¹è¡¨personå®šä¹‰äº†ç‚¹çš„å±æ€§ä¿¡æ¯å’Œidå­—æ®µï¼Œidå­—æ®µå”¯ä¸€æ ‡è¯†å›¾é‡Œé¢çš„ç‚¹ï¼Œä¸ºç‚¹è¡¨çš„ä¸»é”®ï¼Œé€šè¿‡**ID **å…³é”®å­—æ¥å®šä¹‰ã€‚è¾¹è¡¨knowsé‡Œé¢å®šä¹‰å¥½å‹å…³ç³»ï¼ŒsrcIdä¸ºå…³ç³»çš„èµ·ç‚¹ï¼Œé€šè¿‡**SOURCE ID**å…³é”®å­—å®šä¹‰ï¼›targetIdä¸ºå…³ç³»çš„ç›®æ ‡ç‚¹ï¼Œé€šè¿‡**DESTINATION ID**å…³é”®å­—å®šä¹‰ã€‚weightå­—æ®µåˆ™ä¸ºè¾¹çš„ä¸€ä¸ªå±æ€§å­—æ®µã€‚ä¸€å¼ å›¾çš„ç‚¹è¾¹æˆ–è€…è¾¹è¡¨å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–è€…å¤šä¸ªå±æ€§å­—æ®µã€‚
### Hudiè¡¨å®šä¹‰
é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€å¼ Hudiç‚¹è¡¨å’ŒHudiè¾¹è¡¨ï¼š
```sql
set geaflow.dsl.window.size = -1;

CREATE TABLE IF NOT EXISTS hudi_person (
  id BIGINT,
  name VARCHAR
) WITH (
   type='hudi', -- hdfs é…ç½®ï¼Œä¹Ÿå¯é€šè¿‡HADOOP_HOMEç¯å¢ƒå˜é‡è·å–
  `geaflow.file.persistent.config.json` = '{\'fs.defaultFS\':\'namenode:9000\'}',
	geaflow.dsl.file.path='/path/to/hudi_person'
);

CREATE TABLE IF NOT EXISTS hudi_knows (
  src_id BIGINT,
  target_id BIGINT,
  weight DOUBLE
) WITH (
  type='hudi', -- hdfs é…ç½®ï¼Œä¹Ÿå¯é€šè¿‡HADOOP_HOMEç¯å¢ƒå˜é‡è·å–
  `geaflow.file.persistent.config.json` = '{\'fs.defaultFS\':\'namenode:9000\'}',
	geaflow.dsl.file.path='/path/to/hudi_knows'
);
```
GeaFlowæ˜¯ä¸€ä¸ªæµå¼å›¾è®¡ç®—å¼•æ“ï¼Œæ•°æ®æºæŒ‰ç…§window sizeåˆ‡åˆ†æˆä¸€ç³»åˆ—çš„window, å¼•æ“ä¼šä¾æ¬¡å¤„ç†è¿™äº›windowçš„æ•°æ®ã€‚å¦‚æœwindow sizeè®¾ç½®ä¸º-1ï¼Œåˆ™ä»£è¡¨ä¸€ä¸ªAll Windowï¼Œå³ä¸€æ¬¡å…¨é‡å¤„ç†æ‰€æœ‰æ•°æ®ã€‚å¯¹äºHudiè¿™æ ·çš„æ‰¹æ•°æ®æºæ¥å£ï¼Œéœ€è¦è®¾ç½®window sizeä¸º-1æ¥å¤„ç†ã€‚
### æ„å›¾
æ„å›¾æ˜¯å°†å¤–éƒ¨æ•°æ®è¡¨çš„æ•°æ®å†™å…¥åˆ°å›¾é‡Œé¢ï¼Œå¯ä»¥é€šè¿‡Insertè¯­å¥æ¥å®Œæˆã€‚å¦‚ä¸‹è¯­å¥ï¼Œåˆ†å¸ƒå°†hudiè¡¨é‡Œé¢çš„æ•°æ®å†™å…¥åˆ°friendå›¾çš„personè¡¨å’Œknowsè¡¨é‡Œé¢ï¼Œå®Œæˆå›¾æ•°æ®çš„æ„å»ºã€‚
```sql
INSERT INTO friend.person(id, name)
SELECT
 id, name
FROM hudi_person
;

INSERT INTO friend.knows
SELECT src_id, target_id, weight * 10
FROM hudi_knows
;
```
### å›¾è®¡ç®—
æ¥ä¸‹æ¥æ˜¯å¯¹æ„å»ºå¥½çš„å›¾æ•°æ®åšå›¾è®¡ç®—ï¼Œæˆ‘ä»¬ä»¥SSSP(å•æºæœ€çŸ­è·¯å¾„)å’Œå››åº¦ç¯è·¯æ£€æŸ¥ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼š
```sql
CREATE TABLE IF NOT EXISTS sssp_result (
  vid int,
	distance bigint
) WITH (
	type='file',
  `geaflow.file.persistent.config.json` = '{\'fs.defaultFS\':\'namenode:9000\'}',
	geaflow.dsl.file.path='/path/to/result'
);
-- å®šä¹‰è®¡ç®—ä½¿ç”¨çš„å›¾
USE GRAPH friend;

INSERT INTO sssp_result
CALL SSSP(1) YIELD (vid, distance)
RETURN vid, distance
;

-- å›¾ç®—æ³•æ‰§è¡Œ
INSERT INTO result
CALL SSSP(1) YIELD (vid, distance)
RETURN vid, distance
;
```
é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªç»“æœè¡¨resultæ¥å­˜æ”¾è®¡ç®—ç»“æœï¼Œç„¶åé€šè¿‡**USE GRAPH**å‘½ä»¤æ¥è®¾ç½®å½“å‰è®¡ç®—ç”¨åˆ°çš„å›¾ã€‚æœ€åé€šè¿‡CALLè¯­å¥æ¥æ‰§è¡ŒSSSPç®—æ³•(å…¶ä¸­SSSPç®—æ³•çš„å…¥å‚ä¸ºèµ·å§‹ç‚¹id), å¹¶å°†è®¡ç®—ç»“æœå†™å…¥ç»“æœè¡¨ã€‚
å››åº¦ç¯è·¯åŒ¹é…å¦‚ä¸‹è¯­å¥ï¼Œé€šè¿‡MatchåŒ¹é…ä¸€ä¸ª4åº¦ç¯è·¯çš„pattern,ç„¶åå°†ç»“æœå†™å‡ºç»“æœè¡¨.
```sql
CREATE TABLE IF NOT EXISTS match_result (
  a_id bigint,
  b_id bigint,
  c_id bigint,
  d_id bigint,
  a1_id bigint
) WITH (
  type='file',
  `geaflow.file.persistent.config.json` = '{\'fs.defaultFS\':\'namenode:9000\'}',
	geaflow.dsl.file.path='/path/to/result2'
);
-- å››åº¦ç¯è·¯åŒ¹é…
INSERT INTO match_result
SELECT
  a_id,
  b_id,
  c_id,
  d_id,
  a1_id
FROM (
  MATCH (a:person) -[:knows]->(b:person) -[:knows]-> (c:person)
   -[:knows]-> (d:person) -> (a:person)
  RETURN a.id as a_id, b.id as b_id, c.id as c_id, d.id as d_id, a.id as a1_id
);
```
## æ€»ç»“
æœ¬æ–‡ä¸»è¦åˆ†æäº†è¡¨æ¨¡å‹çš„ç°çŠ¶å’Œé—®é¢˜ï¼Œç„¶åä»‹ç»äº†å›¾æ¨¡å‹åœ¨å¤„ç†å…³ç³»è¿ç®—ä¸Šçš„ä¼˜åŠ¿ï¼Œæ¥ç€ä»‹ç»äº†å›¾è®¡ç®—å¼•æ“GeaFlowå’Œæ•°æ®æ¹–æ ¼å¼hudiçš„æ•´åˆï¼Œåˆ©ç”¨å›¾è®¡ç®—å¼•æ“åŠ é€Ÿæ•°æ®æ¹–ä¸Šçš„å…³ç³»è¿ç®—.

GeaFlow(å“ç‰ŒåTuGraph-Analytics) å·²æ­£å¼å¼€æºï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï¼ï¼ï¼

æ¬¢è¿ç»™æˆ‘ä»¬ Star å“¦!

Welcome to give us a Star!

GitHubğŸ‘‰[https://github.com/TuGraph-family/tugraph-analytics](https://github.com/TuGraph-family/tugraph-analytics)

## å¾®ä¿¡ç¾¤
![image](../../../../assets/images/wechat.png)

è¯·ç‚¹å‡»é¡¹ç›®é“¾æ¥ä¸‹æ–¹å¾®ä¿¡äºŒç»´ç æ·»åŠ å¾®ä¿¡ç”¨æˆ·ç¾¤ï¼š[https://github.com/TuGraph-family/tugraph-analytics](https://github.com/TuGraph-family/tugraph-analytics)




