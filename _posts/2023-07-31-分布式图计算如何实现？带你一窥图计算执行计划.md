---
layout: post
read_time: true
show_date: true
show_author: true
title: "åˆ†å¸ƒå¼å›¾è®¡ç®—å¦‚ä½•å®ç°ï¼Ÿå¸¦ä½ ä¸€çª¥å›¾è®¡ç®—æ‰§è¡Œè®¡åˆ’"
date: 2023-07-31
tags: [å›¾è®¡ç®—, æ‰§è¡Œè®¡åˆ’, åˆ†å¸ƒå¼, GeaFlow, å¼€æº, github]
category: opinion
author: TuGraph
description: "åˆ†å¸ƒå¼å›¾è®¡ç®—å¦‚ä½•å®ç°ï¼Ÿå¸¦ä½ ä¸€çª¥å›¾è®¡ç®—æ‰§è¡Œè®¡åˆ’"
---

## å›¾çš„éå†

æˆ‘ä»¬ä¸€èˆ¬è¯´çš„çš„å›¾ç®—æ³•æ˜¯æŒ‡åœ¨å›¾ç»“æ„ä¸Šè¿›è¡Œè¿­ä»£è®¡ç®—çš„è®¡ç®—è¿‡ç¨‹ï¼Œä¾‹å¦‚æœ‰æœ€çŸ­è·¯å¾„ç®—æ³•ã€æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ã€PageRankç®—æ³•ç­‰ã€‚ è¿™äº›ç®—æ³•å¾€å¾€ç”¨äºè§£å†³å›¾ä¸Šçš„ç‰¹å®šä¸€ç±»é—®é¢˜ã€‚ä¾‹å¦‚æœ€çŸ­è·¯å¾„ç®—æ³•ä¸»è¦ç”¨äºå¯»æ‰¾ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼ŒPageRankç®—æ³•åˆ™å¯ä»¥ç»™èŠ‚ç‚¹é‡è¦æ€§æ’åºã€‚

ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ç±»è¢«å¹¿æ³›ä½¿ç”¨çš„'å›¾ç®—æ³•'ï¼Œå®ƒä»¬ä¹Ÿé€šè¿‡è¿­ä»£è®¡ç®—å¤„ç†ï¼Œä¸”åœ¨å®é™…åº”ç”¨ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œå¦‚é‡‘èé£é™©ç®¡ç†ã€ç¤¾äº¤ç½‘ç»œåˆ†æç­‰ã€‚

å®ƒä»¬å°±æ˜¯å›¾éå†ï¼Œåˆè¢«ç§°ä¹‹ä¸ºTraversalã€‚å›¾Traversalè§£å†³éå†å›¾ä¸­èŠ‚ç‚¹çš„é—®é¢˜ï¼Œé€šè¿‡å¯æ§çš„é¡ºåºè®¿é—®å›¾ä¸­èŠ‚ç‚¹å’Œè¾¹ï¼Œä»¥ä¾¿å¯¹å›¾è¿›è¡Œå¤„ç†æˆ–æ”¶é›†ä¿¡æ¯ã€‚

ä¸€èˆ¬çš„å›¾éå†ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç§ä¸»è¦ç±»å‹ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰ã€‚æ‰‹å·¥å®ç°ç®—æ³•åªæœ‰æ—¢å®šçš„èµ°å›¾éå†æ¨¡å¼ï¼Œå¾ˆéš¾è§£å†³ç‰¹å®šçš„å›¾æŸ¥è¯¢é—®é¢˜ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨è¿™ä¸ªç®€å•ç¤ºä¾‹å›¾ä¸­ï¼Œå¦‚æœè¦æŸ¥æ‰¾æ‰€æœ‰çš„'äººåˆ›å»ºè½¯ä»¶'çš„æ¨¡å¼ï¼Œæ— è®ºDFSè¿˜æ˜¯BFSéƒ½éœ€è¦å®ç°å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œæ— æ³•ç›´è§‚å–å¾—ç»“æœã€‚

![image](../../../../assets/images/posts/20230731/g1.png)

å› æ­¤ï¼ŒåŸºäºå›¾æŸ¥è¯¢ä¸­çš„å¤šå…ƒåŒ–èµ°å›¾éœ€è¦ï¼Œå›¾æŸ¥è¯¢è¯­è¨€è‡ªç„¶äº§ç”Ÿã€‚äººä»¬å¸Œæœ›ä½¿ç”¨è¯¸å¦‚  (:person)-[:created]->(:software)  çš„æè¿°æ¥è¾¾æˆéœ€æ±‚ã€‚

## å›¾æŸ¥è¯¢è¯­è¨€GQL

ä¸»æµçš„å›¾æŸ¥è¯¢è¯­è¨€æœ‰Gremlinå’ŒGQLç­‰ï¼Œå…¶ä¸­Gremlinæ˜¯ç›´æ¥å‘½ä»¤å¼è¯­è¨€ï¼Œæ¯ä¸€ä¸ªè°ƒç”¨éƒ½æ˜ç¡®åœ°å£°æ˜äº†ä¸‹ä¸€æ­¥èµ°å›¾çš„æ–¹å‘ã€‚å¯¹äºå‘½ä»¤è¯­è¨€ï¼ŒæŸ¥è¯¢æœ¬èº«å°±æ˜¯æ‰§è¡Œè®¡åˆ’ï¼Œè®¡ç®—æœºå®¹æ˜“ç†è§£ï¼Œä½†äººç±»å­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼Œç†è§£å›°éš¾ã€‚

GQLåˆ™æ˜¯å£°æ˜å¼è¯­è¨€ï¼Œç®€å•ç›´è§‚ï¼Œä¾‹å¦‚'(:person)-[:created]->(:software)'å°±è¡¨ç¤ºäº†æˆ‘ä»¬è¦æŸ¥æ‰¾äººåˆ›å»ºè½¯ä»¶çš„æ¨¡å¼ã€‚'Return person.name, software.name;'å°±å¯ä»¥ç«‹å³è·å¾—ä½œè€…å’Œè½¯ä»¶çš„åç§°ï¼Œå¤§å¤§é™ä½äº†äººç†è§£è¯­è¨€çš„æˆæœ¬ï¼Œå­¦ä¹ æˆæœ¬æ¥è¿‘äºé›¶ã€‚

ç„¶è€Œå£°æ˜å¼è¯­è¨€çš„ç¼ºç‚¹æ˜¯æè¿°ä¸ç›´æ¥ååº”è®¡ç®—æœºæ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå› æ­¤éœ€è¦æ‰§è¡Œå¹³å°å°†å…¶'ç¿»è¯‘'ä¸ºè®¡ç®—æœºå¯ä»¥ç†è§£çš„æ‰§è¡Œè®¡åˆ’æ¥å¤„ç†ã€‚

## åˆ†å¸ƒå¼å›¾éå†æ‰§è¡Œè®¡åˆ’
å›¾æ•°æ®çš„è§„æ¨¡å¾€å¾€ååˆ†åºå¤§ï¼Œä¾‹å¦‚Githubäº¤äº’çš„å›¾è§„æ¨¡å¯ä»¥åˆ°è¾¾æ•°ç™¾TBè§„æ¨¡ï¼Œé‡‘èäº¤æ˜“æ•°æ®çš„è§„æ¨¡å¯ä»¥è¾¾åˆ°ä¸‡äº¿è§„æ¨¡ã€‚å¦‚æ­¤å¤æ‚çš„å›¾æ— æ³•é€šè¿‡å•æœºå®Œæˆéå†è®¡ç®—ã€‚

å› æ­¤åˆ†å¸ƒå¼å›¾è®¡ç®—å¼•æ“éœ€è¦çš„æ˜¯å¯ä»¥åˆ†å¸ƒå¼æ‰§è¡Œçš„è®¡åˆ’ï¼Œè¿™å¯¹æ‰§è¡Œè®¡åˆ’çš„æ•ˆç‡ã€å¯æ‰©å±•æ€§ã€è´Ÿè½½å‡è¡¡æ€§æå‡ºäº†æé«˜è¦æ±‚ã€‚

æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå¸¸è§GQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¸€æ¢ç©¶ç«Ÿã€‚è¿™é‡Œä»¥èš‚èšé›†å›¢å¼€æºçš„å›¾è®¡ç®—ç³»ç»ŸGeaFlow(å“ç‰Œåä¸ºTuGraph-Analytics)ä¸ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦æ–‡æœ«æœ‰å¼€æºåœ°å€ã€‚

### èµ°å›¾
ä»¥ç¤ºä¾‹å›¾ä¸ºä¾‹ï¼Œæˆ‘ä»¬è¦æŸ¥çœ‹äººä¸äººä¹‹é—´çš„å¥½å‹å…³ç³»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹GQLæè¿°ã€‚

```sql
MATCH (a:person)-[e:knows]-(b:person where b.id != 1)
RETURN a.id as a_id, e.weight as weight, b.id as b_id;
```

è¯¥æè¿°éå¸¸ç›´è§‚ï¼Œè¡¨ç¤ºäº†æŸ¥è¯¢ä¸¤ä¸ªäººa, bä¹‹é—´ç±»å‹ä¸ºknowsçš„è¾¹ï¼Œè¦æ±‚bçš„idä¸èƒ½ä¸º1ï¼Œè¿”å›ä¸‰ä¸ªç»“æœå­—æ®µä½œä¸ºç»“æœè¡¨ã€‚

![image](../../../../assets/images/posts/20230731/g2.png)

ç”±äºæŸ¥è¯¢å¹¶ä¸å¤æ‚ï¼Œå…¶äº§ç”Ÿçš„æ‰§è¡Œè®¡åˆ’ä¹Ÿä¸å¤æ‚ï¼Œåªæœ‰6ä¸ªæ­¥éª¤ã€‚

StepSourceè¡¨ç¤ºè¯»å–å›¾ï¼Œæ•°å­—è¡¨ç¤ºæ­¥éª¤çš„æ ‡è¯†IDã€‚MatchVertexæ­¥éª¤è¡¨ç¤ºåŒ¹é…å¯¹åº”ç±»å‹çš„ç‚¹ï¼Œä¾‹å¦‚ç‚¹aè¢«å£°æ˜ä¸ºpersonç±»å‹ï¼Œåˆ™å¿…é¡»æŠŠå…¶ä»–ç±»å‹çš„ç‚¹è¿‡æ»¤æ‰ã€‚

MatchEdgeæ­¥éª¤è¡¨ç¤ºåŒ¹é…å¯¹åº”ç±»å‹çš„è¾¹ï¼ŒBOTHè¡¨ç¤ºè¾¹çš„æ–¹å‘ä¸é™ï¼Œå› ä¸ºå¥½å‹å…³ç³»æ˜¯ä¸€ç§ç›¸äº’çš„å…³ç³»ã€‚

StepFilteræ­¥éª¤å¯¹åº”äº†GQLæŸ¥è¯¢ä¸­çš„b.id != 1æ¡ä»¶ï¼Œç±»ä¼¼SQLè¯­è¨€çš„WHEREè¯­å¥ï¼Œä¼šè¢«ç¿»è¯‘æˆä¸€ä¸ªç‰¹å®šæ­¥éª¤ã€‚StepEndæ­¥éª¤è¡¨ç¤ºæ‰§è¡Œè®¡åˆ’ç»“æŸã€‚

å…³æ³¨ç»†èŠ‚çš„åŒå­¦å¯èƒ½å‘ç°äº†ï¼Œåœ¨MatchEdge(e)å’ŒMatchVertex(b)ä¹‹é—´è¢«æ ‡è®°ä¸ºä¸èƒ½ä¸²è”ã€‚

è¿™å®é™…å¯¹åº”äº†èµ°å›¾çš„Shuffleè¿‡ç¨‹ï¼ŒåŒ¹é…ç‚¹å’Œè¾¹éƒ½å¯ä»¥åœ¨ä¸€ä¸ªç‚¹åŸåœ°å®Œæˆï¼Œè¿™åœ¨ç‰©ç†ä¸Šå¯¹åº”äº†ä¸€å°æœºå™¨ã€‚å¦‚æœæˆ‘ä»¬ä»å‡ºè¾¹èµ°åˆ°å…¶å¯¹ç«¯ç‚¹ï¼Œåˆ™å¯¹ç«¯ç‚¹å¯èƒ½å¹¶ä¸å­˜å‚¨åœ¨è¿™å°æœºå™¨ä¸Šï¼Œå› æ­¤ä¼šäº§ç”Ÿæ•°æ®Shuffleè¿‡ç¨‹ï¼Œç›¸å½“äºDFS/BFSç®—æ³•ä¸­çš„æ·±åº¦+1ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’ä¸Šåæ˜ ä¸ºä¸¤ä¸ªå•æ­¥ä¸å¯ä¸²è”ã€‚

### èšåˆ

ç®€å•çš„èµ°å›¾è¿‡ç¨‹å‡ ä¹å¯ä»¥è¢«BFS/DFSç®—æ³•çš„å®ç°æ‰€æ›¿ä»£ï¼Œä¾‹å¦‚ä¸Šé¢èµ°å›¾çš„ç®€å•ä¾‹å­ï¼Œå¯ä»¥è½¬åŒ–ä¸º2è½®è¿­ä»£çš„éå†å®Œæˆã€‚

ä½†å®é™…ä¸Šï¼Œéšç€å›¾ç ”å‘çš„æ·±å…¥ï¼Œèµ°å›¾éœ€æ±‚ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œç›¸åº”åœ°GQLæŸ¥è¯¢ä¼šè¶Šæ¥è¶Šé•¿ï¼Œæ‰§è¡Œè®¡åˆ’ä¹Ÿä¼šå˜å¾—å¤æ‚ã€‚ä¸€æ—¦æ‰§è¡Œè®¡åˆ’å¤æ‚åˆ°ä¸€å®šç¨‹åº¦ï¼Œäººå·¥å®ç°å°±å˜å¾—ä¸ç°å®äº†ã€‚

æ¥çœ‹è¿™ä¸ªç‚¹ä¸Šèšåˆçš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬ä»ç‚¹aèµ°åˆ°ç‚¹båï¼Œå‘èµ·ä¸€ä¸ªèšåˆå­æŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢è¿‡æ»¤äº†bç‚¹åˆ›å»ºè½¯ä»¶çš„æ•°é‡ï¼Œè¦æ±‚è¯¥æ•°é‡ä¸º0ã€‚å¾…å­æŸ¥è¯¢è¿”å›åï¼Œæ ¹æ®å…¶ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ¡ä»¶è¿‡æ»¤è·¯å¾„ï¼Œç„¶åè¾“å‡ºç»“æœæ‰€éœ€çš„a, bå¯¹ã€‚

```sql
MATCH (a:person where a.id = 1)-[e:knows]->(b:person)
WHERE COUNT((b)-[:created]->(c:software) => c) = 0
RETURN a.id as a_id, b.id as b_id;
```

è¯¥æŸ¥è¯¢äº§ç”Ÿçš„æ‰§è¡Œè®¡åˆ’å¦‚å›¾ã€‚è¿™ä¸ªæ‰§è¡Œè®¡åˆ’åŒ…å«äº†ä¸€ä¸ªåµŒå¥—å…³ç³»ï¼Œåœ¨æ­¥éª¤14è¿›å…¥å­æŸ¥è¯¢1ã€‚å­æŸ¥è¯¢1åœ¨æ­¥éª¤13è¿”å›ï¼Œæ ¹æ®è¿”å›ç»“æœæˆ‘ä»¬æ‰èƒ½ç»§ç»­æ‰§è¡Œæ­¥éª¤15ã€‚

![image](../../../../assets/images/posts/20230731/g3.png)

å¤šä¹ˆçš„å¤æ‚ï¼æˆ‘ç›¸ä¿¡æ²¡æœ‰äººæ„¿æ„æ‰‹å·¥å®ç°è¿™ä¸ªå›¾ç®—æ³•çš„ã€‚

ç»†å¿ƒçš„åŒå­¦ä¸éš¾å‘ç°ï¼ŒCOUNT()ç®—å­è¢«ç¿»è¯‘ä¸ºç‚¹ä¸Šèšåˆæ­¥éª¤ï¼Œä¸”åˆ†ä¸ºäº†å±€éƒ¨èšåˆ(æ­¥éª¤10)å’Œå…¨å±€èšåˆ(æ­¥éª¤12)ã€‚è¿™æ˜¯åˆ†å¸ƒå¼è®¡ç®—çš„è€ƒè™‘ï¼Œå¦‚æœåœ¨æ¯ä¸ªç‚¹ä¸Šï¼ŒæŠŠæœ¬åœ°çš„ç»“æœè®¡æ•°ï¼Œæå‰äº§ç”ŸCOUNTå€¼çš„ä¸­é—´ç»“æœï¼Œå†å‘é€åˆ°å…¨å±€åŠ å’Œï¼Œå°±èƒ½å¤Ÿé™ä½é€šä¿¡å’Œè®¡ç®—çš„å¼€é”€ã€‚

### å¾ªç¯

å¥½äº†ï¼æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å›¾è®¡ç®—æ‰§è¡Œè®¡åˆ’çš„æ€è·¯ï¼Œè®©æˆ‘ä»¬å®ç°æ›´å¤šçš„æŸ¥è¯¢å§ã€‚

è¿™ä¸ªæ˜¯ç¤¾äº¤åˆ†æçš„ä¸€ä¸ªä¾‹å­ï¼Œæ¥è‡ªLDBCæµ‹è¯•é›†çš„BI03æµ‹è¯•ã€‚

```sql
MATCH (forum:Forum)-[:hasModerator]->(person:Person)
-[:isLocatedIn]-(:City)
-[:isPartOf]->(:Country where name = 'Belarus')
, (forum:Forum)-[:containerOf]->(:Post)
<-[:replyOf]-{0,}(msg:Post|Comment)
-[:hasTag]->(tag)
, (:TagClass where name = 'Comedian')<-[:hasType]-(tag)
RETURN forum.id as forumId, forum.title, forum.creationDate,
person.id as personId, Count(DISTINCT msg.id) as messageCount
GROUP BY forumId, title, creationDate, personId
ORDER BY messageCount DESC, forumId LIMIT 20
;
```

åœ¨è¯¥æŸ¥è¯¢ä¸­æˆ‘ä»¬å¤„ç†äº†ä¸€ä¸ªå¾ªç¯'<-[:replyOf]-{0,}'ï¼Œä»è€Œé€’å½’åœ°è·å–åšæ–‡postçš„æ‰€æœ‰å›å¤ã€‚è¿™å¯¹åº”ç€æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤15çš„LoopUtilç®—å­ã€‚

![image](../../../../assets/images/posts/20230731/g4.png)

### å…¨å±€æ ‡è®°

èµ°å›¾è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡LETè¯­å¥ï¼Œå¯ä»¥å°†çŠ¶æ€æš‚å­˜åœ¨ç‚¹ä¸Šï¼Œä»¥ä¾¿åœ¨åç»­ä½¿ç”¨ã€‚ä¾‹å¦‚ä»¥ä¸‹æŸ¥è¯¢ï¼Œæ¥è‡ªLDBC BI08æµ‹è¯•ï¼Œè¯¥æµ‹è¯•ä¸­æˆ‘ä»¬å…ˆè®¡ç®—æ¯ä¸ªäººçš„åˆ†æ•°ï¼Œåœ¨Personç±»å‹ç‚¹ä¸Šè¿›è¡Œæ ‡è®°ï¼Œä»¥ä¾¿åœ¨èµ°å›¾åˆ°firendæ—¶å–å€¼ä½¿ç”¨ã€‚

```sql
MATCH (person:Person)
LET person.hasInterest = COUNT((person:Person)-[:hasInterest]->(tag where id = 1020002) => tag.id)
LET person.messageScore = COUNT((person:Person)<-[:hasCreator]-(message:Post|Comment)
                                -[:hasTag]->(tag where id = 1020002) => tag.id)
LET GLOBAL person.score = person.messageScore + IF(person.hasInterest > 0, 100, 0)
MATCH (person:Person)-[:knows]-{0,1}(friend:Person)
RETURN person.id as personId, person.score as personCentralityScore,
SUM(IF(friend.id = person.id, CAST(0 as BIGINT), CAST(friend.score as BIGINT))) as friendScore
GROUP BY personId, personCentralityScore
ORDER BY personCentralityScore + friendScore DESC, personId LIMIT 100
;
```

è¿™åœ¨æ‰§è¡Œè®¡åˆ’ä¸­ä½“ç°ä¸ºStepMapæ­¥éª¤ï¼Œä¸‰ä¸ªStepMapæ­¥éª¤åˆ†åˆ«å®Œæˆä¸‰ä¸ªLETè¯­å¥çš„åŠŸèƒ½ã€‚å¯ä»¥æ•°ä¸€æ•°ï¼Œè¿™ä¸ªæ‰§è¡Œè®¡åˆ’æ€»å…±éœ€è¦å¤šå°‘è½®è¿­ä»£å‘¢ï¼Ÿ

![image](../../../../assets/images/posts/20230731/g5.png)

## æ€»ç»“

æœ¬æ–‡ä»‹ç»äº†GeaFlowå›¾è®¡ç®—å¼•æ“å¦‚ä½•ä½¿ç”¨GQLå›¾æŸ¥è¯¢è¯­è¨€è¿›è¡Œèµ°å›¾æŸ¥è¯¢ï¼Œå¹¶ä»‹ç»äº†å‡ ç±»æŸ¥è¯¢è¯­å¥å¯¹åº”ç”Ÿæˆçš„å›¾è®¡ç®—æ‰§è¡Œè®¡åˆ’ã€‚


GeaFlow(å“ç‰ŒåTuGraph-Analytics) å·²æ­£å¼å¼€æºï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï¼ï¼ï¼

æ¬¢è¿ç»™æˆ‘ä»¬ Star å“¦!

Welcome to give us a Star!

GitHubğŸ‘‰[https://github.com/TuGraph-family/tugraph-analytics](https://github.com/TuGraph-family/tugraph-analytics)

## å¾®ä¿¡ç¾¤
![image](../../../../assets/images/wechat.png)

è¯·ç‚¹å‡»é¡¹ç›®é“¾æ¥ä¸‹æ–¹å¾®ä¿¡äºŒç»´ç æ·»åŠ å¾®ä¿¡ç”¨æˆ·ç¾¤ï¼š[https://github.com/TuGraph-family/tugraph-analytics](https://github.com/TuGraph-family/tugraph-analytics)




